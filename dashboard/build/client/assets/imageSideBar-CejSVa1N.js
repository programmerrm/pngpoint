import{a as w,o,p as X,v as Y}from"./chunk-D4RADZKF-BJUHQB5c.js";import{u as Z,F as x}from"./field-B9-6QqNw.js";import{b as d}from"./authSlice-NXvFQZCo.js";import{R as t}from"./reactIcons-CcwffGRm.js";import{a as P}from"./apiSlice-B5w1slPB.js";import{c as O,a as R}from"./imageSideBarSlice-CGV1wOS1.js";const a=P.injectEndpoints({endpoints:r=>({numberOfImageDelet:r.mutation({query:l=>({url:`/images/delete/?image_ids=${Array.isArray(l)?l.join(","):l}`,method:"DELETE"})}),allImageDelete:r.mutation({query:()=>({url:"/images/deleted-all/",method:"DELETE"})})})}),{useNumberOfImageDeletMutation:M}=a,rr=P.injectEndpoints({endpoints:r=>({updatedImage:r.mutation({query:({id:l,data:f})=>({url:`/images/${l}/updated/`,method:"PATCH",headers:{"Content-Type":"application/json"},body:f})})})}),{useUpdatedImageMutation:or}=rr;function mr({selectedMetadata:r,selectedCount:l,selectedIds:f,setLoading:h}){var _,E,D,k,C,F,K,T,A,L;const[p,g]=w.useState(((_=r==null?void 0:r.keywords)==null?void 0:_.map(n=>({id:n.id,name:n.name})))||[]),[B,b]=w.useState(!1),[S,v]=w.useState(""),{handleSubmit:U,register:y,reset:I,setValue:e,formState:{errors:m}}=Z(),{RiDeleteBin6Line:$}=t,[q]=or(),[z]=M(),c=d(),H=()=>{const n=S.trim();if(!n||p.find(j=>j.name.toLowerCase()===n.toLowerCase())){v(""),b(!1);return}const s=p.reduce((j,N)=>typeof N.id=="number"&&N.id>j?N.id:j,0)+1,u=[...p,{id:s,name:n}];g(u),e("keywords",u),v(""),b(!1)},V=n=>{const i=p.filter(s=>s.name!==n);g(i),e("keywords",i)};w.useEffect(()=>{var i;const n=((i=r==null?void 0:r.keywords)==null?void 0:i.map(s=>({id:s.id??null,name:s.name})))||[];I({title:(r==null?void 0:r.title)||"",description:(r==null?void 0:r.description)||"",status:(r==null?void 0:r.status)||"",category:(r==null?void 0:r.category)||"",keywords:n}),g(n)},[r,I]);const G=n=>["approved","pending","rejected"].filter(s=>s!==n),J=r==null?void 0:r.id,Q=async n=>{try{h("delete"),setTimeout(async()=>{try{await z(n).unwrap()}catch(i){console.error("Delete failed:",i),alert("Failed to delete selected images.")}finally{h(null)}},2e3),c(O()),c(R())}catch(i){console.error("Outer Error:",i)}},W=async n=>{const i=p.map(u=>({id:u.id,name:u.name})),s={...n,keywords:i};try{h("update"),setTimeout(async()=>{try{await q({id:J,data:s}).unwrap()}catch(u){console.error("Update failed:",u),alert("Failed to update image.")}finally{h(null)}},2e3),c(O()),c(R())}catch(u){console.error("Outer Error:",u)}};return o.jsx("div",{className:"block w-full h-full px-2.5 py-2.5 border rounded-md overflow-scroll scrollbar-width",children:o.jsxs("div",{className:"flex flex-col flex-wrap gap-y-2.5 w-full",children:[o.jsxs("div",{className:"flex flex-row flex-wrap items-center justify-between py-2.5 px-2.5 rounded bg-gray-300 w-full",children:[o.jsxs("p",{children:[l," images selected"]}),o.jsx("button",{className:"cursor-pointer",type:"button",onClick:()=>Q(f),children:o.jsx($,{className:"text-2xl"})})]}),o.jsx("div",{className:"flex flex-col w-full",children:o.jsx("img",{className:"block w-full h-auto rounded",src:`${r==null?void 0:r.url}`,alt:r==null?void 0:r.title})}),o.jsxs("form",{className:"flex flex-col gap-y-3.5 w-full",onSubmit:U(W),children:[o.jsx(x,{label:"Title",error:m.title,children:o.jsx("input",{className:"border py-2.5 px-2.5 rounded w-full",...y("title"),type:"text",id:"title"})}),o.jsx(x,{label:"Description",error:m.description,children:o.jsx("textarea",{className:"border py-2.5 px-2.5 rounded w-full",...y("description"),id:"description"})}),o.jsx(x,{label:"Keywords",error:m.keywords,children:o.jsxs(X.Fragment,{children:[o.jsx("div",{className:"flex flex-wrap gap-2 border py-2.5 px-2.5 rounded",children:p.map((n,i)=>o.jsxs("span",{className:"bg-gray-200 px-2 py-1 rounded-full flex items-center gap-1",children:[n.name,o.jsx("button",{type:"button",onClick:()=>V(n.name),className:"text-red-500 cursor-pointer",children:"Ã—"})]},i))}),B&&o.jsx("input",{type:"text",className:"border py-2.5 px-2.5 rounded w-full",value:S,onChange:n=>v(n.target.value),onKeyDown:n=>{n.key==="Enter"&&(n.preventDefault(),H())},autoFocus:!0}),o.jsx("div",{className:"flex flex-col flex-wrap justify-center items-center",children:o.jsx("button",{type:"button",className:"text-blue-600 text-sm mt-2 cursor-pointer w-fit",onClick:()=>b(!0),children:"+ Add keyword"})})]})}),o.jsx(x,{label:"Category",error:m.category,children:o.jsxs("select",{className:"border py-2.5 px-2.5 rounded w-full capitalize",...y("category"),id:"category",children:[o.jsx("option",{value:r==null?void 0:r.category,defaultValue:r==null?void 0:r.category,children:r==null?void 0:r.category}),o.jsx("option",{value:"animals",children:"Animals"}),o.jsx("option",{value:"buildings_and_architecture",children:"Buildings and Architecture"}),o.jsx("option",{value:"business",children:"Business"}),o.jsx("option",{value:"drinks",children:"Drinks"}),o.jsx("option",{value:"the_environment",children:"The Environment"}),o.jsx("option",{value:"states_of_mind",children:"States of Mind"}),o.jsx("option",{value:"food",children:"Food"}),o.jsx("option",{value:"graphic_resources",children:"Graphic Resources"}),o.jsx("option",{value:"hobbies_and_leisure",children:"Hobbies and Leisure"}),o.jsx("option",{value:"industry",children:"Industry"}),o.jsx("option",{value:"landscape",children:"Landscape"}),o.jsx("option",{value:"lifestyle",children:"Lifestyle"}),o.jsx("option",{value:"people",children:"People"}),o.jsx("option",{value:"plants_and_flowers",children:"Plants and Flowers"}),o.jsx("option",{value:"culture_and_religion",children:"Culture and Religion"}),o.jsx("option",{value:"science",children:"Science"}),o.jsx("option",{value:"social_issues",children:"Social Issues"}),o.jsx("option",{value:"sports",children:"Sports"}),o.jsx("option",{value:"technology",children:"Technology"}),o.jsx("option",{value:"transport",children:"Transport"})]})}),o.jsx(x,{label:"Status",error:m.status,children:o.jsxs("select",{className:"border py-2.5 px-2.5 rounded w-full capitalize",...y("status"),id:"status",children:[(r==null?void 0:r.status)&&o.jsx("option",{value:r==null?void 0:r.status,children:r==null?void 0:r.status}),G(r==null?void 0:r.status).map(n=>o.jsx("option",{value:n,children:n},n))]})}),o.jsxs("div",{className:"flex flex-col flex-wrap gap-2.5",children:[o.jsx("h4",{className:"text-base font-medium",children:"Contributor :"}),o.jsxs("div",{className:"flex flex-col flex-wrap gap-y-1.5",children:[((E=r==null?void 0:r.user)==null?void 0:E.username)&&o.jsxs("span",{children:["Username : ",(D=r==null?void 0:r.user)==null?void 0:D.username]}),((k=r==null?void 0:r.user)==null?void 0:k.first_name)&&o.jsxs("span",{children:["First Name : ",(C=r==null?void 0:r.user)==null?void 0:C.first_name]}),((F=r==null?void 0:r.user)==null?void 0:F.last_name)&&o.jsxs("span",{children:["Last Name : ",(K=r==null?void 0:r.user)==null?void 0:K.last_name]}),((T=r==null?void 0:r.user)==null?void 0:T.email)&&o.jsxs(Y,{className:"w-fit",to:`mailto:${(A=r==null?void 0:r.user)==null?void 0:A.email}`,children:["Email : ",(L=r==null?void 0:r.user)==null?void 0:L.email]})]})]}),o.jsx("div",{className:"flex flex-col",children:o.jsx("button",{className:"bg-blue-500 text-white py-2.5 px-2.5 rounded-full cursor-pointer",type:"submit",children:"Save"})})]})]})})}export{mr as I};
